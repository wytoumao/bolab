<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BTC Dashboard | Bo's Lab</title>
  <meta name="description" content="æ¯”ç‰¹å¸å®æ—¶çœ‹æ¿ï¼šå…³æœºå¸ä»·ã€200å‘¨å‡çº¿ã€å‡è¡¡ä»·æ ¼ã€MVRVã€å‡åŠå€’è®¡æ—¶ã€ææƒ§è´ªå©ªæŒ‡æ•°ç­‰æ ¸å¿ƒé“¾ä¸ŠæŒ‡æ ‡ï¼Œä¸€é¡µæŒæ¡ BTC å‘¨æœŸä½ç½®ã€‚">
  <meta name="keywords" content="æ¯”ç‰¹å¸,BTC,å…³æœºå¸ä»·,200å‘¨å‡çº¿,MVRV,å‡åŠå€’è®¡æ—¶,é“¾ä¸ŠæŒ‡æ ‡,æ¯”ç‰¹å¸çœ‹æ¿,Bitcoin Dashboard">
  <meta property="og:title" content="æ¯”ç‰¹å¸çœ‹æ¿ | BTC Dashboard">
  <meta property="og:description" content="å®æ—¶é“¾ä¸ŠæŒ‡æ ‡ä¸å‘¨æœŸåˆ†æï¼šå…³æœºå¸ä»·ã€200WMAã€å‡è¡¡ä»·æ ¼ã€MVRVã€å‡åŠå€’è®¡æ—¶">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://fuckbtc.com">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="æ¯”ç‰¹å¸çœ‹æ¿ | BTC Dashboard">
  <meta name="twitter:description" content="å®æ—¶é“¾ä¸ŠæŒ‡æ ‡ä¸å‘¨æœŸåˆ†æï¼Œä¸€é¡µæŒæ¡ BTC å‘¨æœŸä½ç½®">
  <link rel="canonical" href="https://fuckbtc.com">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>â‚¿</text></svg>">
  <style>
    :root {
      --bg: #1a1a2e;
      --card: #16213e;
      --border: #0f3460;
      --text: #eaeaea;
      --dim: #8a8a8a;
      --gold: #f7931a;
      --green: #4cd964;
      --red: #e74c5f;
      --blue: #4da6ff;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg); color: var(--text);
      min-height: 100vh; padding: 16px;
    }
    .container { max-width: 960px; margin: 0 auto; }

    .stats-bar {
      display: flex; flex-wrap: wrap; gap: 12px;
      margin-bottom: 16px; padding: 14px 18px;
      background: var(--card); border-radius: 10px; border: 1px solid var(--border);
    }
    .stat-item { flex: 1; min-width: 110px; }
    .stat-label { font-size: 11px; color: var(--dim); margin-bottom: 2px; }
    .stat-value { font-size: 20px; font-weight: 700; }
    .stat-value.price { color: var(--gold); }
    .stat-value.hashrate { color: var(--blue); }
    .stat-value.range { font-size: 14px; }
    .stat-value .profit { color: var(--green); }

    /* Fear & Greed Gauge - TradingView é£æ ¼ */
    .fng-section {
      display: flex; align-items: center; gap: 20px;
      margin-bottom: 16px; padding: 16px 20px;
      background: var(--card); border-radius: 10px; border: 1px solid var(--border);
    }
    .gauge-container {
      position: relative; width: 140px; height: 80px; flex-shrink: 0;
    }
    .gauge-bg {
      position: absolute; top: 0; left: 0; width: 140px; height: 70px;
      border-radius: 70px 70px 0 0; overflow: hidden;
    }
    .gauge-segment {
      position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
      transform-origin: center bottom;
    }
    .gauge-center {
      position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
      width: 80px; height: 40px; background: var(--card);
      border-radius: 40px 40px 0 0;
    }
    .gauge-needle {
      position: absolute; bottom: 0; left: 50%;
      width: 2px; height: 55px; background: white;
      transform-origin: bottom center;
      border-radius: 2px; margin-left: -1px;
      transition: transform 0.8s ease;
    }
    .gauge-needle::after {
      content: ''; position: absolute; bottom: -4px; left: -4px;
      width: 10px; height: 10px; background: white;
      border-radius: 50%;
    }
    .gauge-value {
      position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%);
      font-size: 22px; font-weight: 700; z-index: 5;
    }
    .gauge-labels {
      display: flex; justify-content: space-between; width: 100%;
      font-size: 9px; color: var(--dim); margin-top: 2px;
    }
    .fng-info { flex: 1; }
    .fng-title { font-size: 13px; color: var(--dim); margin-bottom: 4px; }
    .fng-status { font-size: 24px; font-weight: 700; margin-bottom: 4px; }
    .fng-desc { font-size: 12px; color: var(--dim); line-height: 1.4; }

    /* å‘¨æœŸæŒ‡æ ‡è¡Œ */
    .cycle-row {
      display: flex; flex-wrap: wrap; gap: 12px;
      margin-bottom: 16px;
    }
    .cycle-card {
      flex: 1; min-width: 200px; padding: 14px 18px;
      background: var(--card); border-radius: 10px; border: 1px solid var(--border);
    }
    .cycle-card-title { font-size: 12px; color: var(--dim); margin-bottom: 6px; }
    .cycle-main { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
    .cycle-sub { font-size: 12px; color: var(--dim); line-height: 1.5; }
    .cycle-sub span { color: var(--text); font-weight: 500; }
    .halving-bar {
      width: 100%; height: 6px; background: rgba(255,255,255,0.1);
      border-radius: 3px; margin-top: 8px; overflow: hidden;
    }
    .halving-fill {
      height: 100%; background: linear-gradient(90deg, var(--gold), var(--green));
      border-radius: 3px; transition: width 0.5s;
    }

    .elec-control {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 18px; background: var(--card);
      border-radius: 10px; border: 1px solid var(--border); margin-bottom: 16px;
    }
    .elec-label { font-size: 12px; color: var(--dim); }
    .elec-slider {
      flex: 1; max-width: 260px; height: 5px;
      -webkit-appearance: none;
      background: linear-gradient(90deg, var(--green), var(--gold), var(--red));
      border-radius: 3px; outline: none;
    }
    .elec-slider::-webkit-slider-thumb {
      -webkit-appearance: none; width: 16px; height: 16px;
      background: white; border-radius: 50%; cursor: pointer;
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }
    .elec-value { font-size: 15px; font-weight: 600; color: var(--gold); min-width: 85px; }

    .percentiles {
      display: flex; margin-bottom: 14px;
      background: var(--card); border-radius: 10px; border: 1px solid var(--border); overflow: hidden;
    }
    .pct-item { flex: 1; padding: 10px 14px; border-right: 1px solid var(--border); }
    .pct-item:last-child { border-right: none; }
    .pct-item.active { background: rgba(247,147,26,0.1); border: 2px solid var(--gold); border-radius: 6px; }
    .pct-label { font-size: 12px; color: var(--dim); }
    .pct-value { font-size: 18px; font-weight: 700; margin-top: 1px; }
    .pct-item.active .pct-value { color: var(--gold); }

    .chart-section {
      background: var(--card); border-radius: 10px;
      border: 1px solid var(--border); padding: 16px; margin-bottom: 16px;
    }
    .chart-title { font-size: 13px; color: var(--dim); margin-bottom: 10px; }

    /* å›¾è¡¨: CSS Grid ç¡®ä¿æ¡å½¢å’Œä»·æ ¼çº¿åœ¨åŒä¸€å®¹å™¨ */
    .chart-grid {
      display: grid;
      grid-template-columns: 140px 1fr;
    }
    .chart-labels {
      display: flex; flex-direction: column;
    }
    .chart-lbl {
      height: 18px; display: flex; align-items: center; justify-content: flex-end;
      font-size: 11px; color: var(--dim); padding-right: 8px;
      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
      margin-bottom: 1px;
    }
    /* å³ä¾§ï¼šæ‰€æœ‰æ¡å½¢ + ä»·æ ¼çº¿å…±äº«åŒä¸€ä¸ªå®¹å™¨ */
    .chart-bars {
      position: relative;
    }
    .cbar {
      height: 14px; margin-bottom: 5px;
      border-radius: 0 2px 2px 0; min-width: 2px;
    }
    .cbar.profit { background: var(--green); }
    .cbar.loss { background: var(--red); }

    /* ä»·æ ¼ç«–çº¿ â€” åœ¨ chart-bars å†…ï¼Œç™¾åˆ†æ¯”ç›´æ¥å¯¹é½æ¡å½¢ */
    .vprice {
      position: absolute; top: 0; bottom: 0; width: 2px;
      background: var(--gold); z-index: 10; pointer-events: none;
    }
    .vprice-tag {
      position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%);
      font-size: 11px; font-weight: 600; color: var(--gold); white-space: nowrap;
    }

    /* X è½´ â€” ç»å¯¹å®šä½å¯¹é½æ¡å½¢ */
    .x-axis-row {
      display: grid; grid-template-columns: 140px 1fr;
      margin-top: 6px;
    }
    .x-axis-track {
      position: relative; height: 20px;
      border-top: 1px solid var(--border);
    }
    .x-tick {
      position: absolute; top: 4px;
      font-size: 10px; color: var(--dim);
      transform: translateX(-50%);
    }
    .x-tick:first-child { transform: translateX(0); }
    .x-tick:last-child { transform: translateX(-100%); }

    .table-section {
      background: var(--card); border-radius: 10px;
      border: 1px solid var(--border); overflow: hidden;
    }
    .table-title { font-size: 14px; font-weight: 600; padding: 12px 16px; border-bottom: 1px solid var(--border); }
    .miner-table { width: 100%; border-collapse: collapse; font-size: 12px; }
    .miner-table th {
      text-align: left; padding: 8px 12px; color: var(--dim);
      font-weight: 500; border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.2);
    }
    .miner-table td { padding: 8px 12px; border-bottom: 1px solid var(--border); }
    .miner-table tr:hover { background: rgba(255,255,255,0.02); }
    .miner-table .model { font-weight: 500; }
    .miner-table .shutdown { font-weight: 600; }
    .miner-table .shutdown.profit { color: var(--green); }
    .miner-table .shutdown.loss { color: var(--red); }
    .status-badge {
      display: inline-block; padding: 2px 8px;
      border-radius: 10px; font-size: 10px; font-weight: 500;
    }
    .status-profit { background: rgba(76,217,100,0.15); color: var(--green); }
    .status-loss { background: rgba(231,76,95,0.15); color: var(--red); }

    .footer { text-align: center; padding: 14px; font-size: 11px; color: var(--dim); }
    .footer a { color: var(--blue); text-decoration: none; }

    .chart-lbl, .x-axis-spacer { width: auto; }

    @media (max-width: 600px) {
      .stat-value { font-size: 15px; }
      .pct-value { font-size: 14px; }
      .chart-grid, .x-axis-row { grid-template-columns: 100px 1fr; }
      .chart-lbl { font-size: 9px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-label">BTC ä»·æ ¼</div>
        <div class="stat-value price" id="btc-price">$--,---</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ç”µè´¹</div>
        <div class="stat-value" id="elec-display" style="color:var(--gold)">$0.060</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">å…¨ç½‘ç®—åŠ›</div>
        <div class="stat-value hashrate" id="hashrate">--- EH/s</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">å…³æœºä»·èŒƒå›´</div>
        <div class="stat-value range" id="range">--- ~ ---</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ç›ˆåˆ©çŸ¿æœº</div>
        <div class="stat-value" id="profit-count"><span class="profit">--</span>/--</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">ahr999 å®šæŠ•æŒ‡æ•°</div>
        <div class="stat-value" id="ahr999" style="color:var(--green)">--</div>
      </div>
    </div>

    <div class="fng-section">
      <div class="gauge-container">
        <div class="gauge-bg">
          <svg width="140" height="70" viewBox="0 0 140 70">
            <path d="M10,70 A60,60 0 0,1 38,18" fill="none" stroke="#e74c5f" stroke-width="12" stroke-linecap="round"/>
            <path d="M38,18 A60,60 0 0,1 70,10" fill="none" stroke="#f7931a" stroke-width="12" stroke-linecap="round"/>
            <path d="M70,10 A60,60 0 0,1 102,18" fill="none" stroke="#f0d000" stroke-width="12" stroke-linecap="round"/>
            <path d="M102,18 A60,60 0 0,1 130,70" fill="none" stroke="#4cd964" stroke-width="12" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="gauge-needle" id="fng-needle" style="transform:rotate(-90deg)"></div>
        <div class="gauge-value" id="fng-value">--</div>
        <div class="gauge-labels"><span>0</span><span>50</span><span>100</span></div>
      </div>
      <div class="fng-info">
        <div class="fng-title">ææƒ§ & è´ªå©ªæŒ‡æ•°</div>
        <div class="fng-status" id="fng-status">--</div>
        <div class="fng-desc" id="fng-desc">åŠ è½½ä¸­...</div>
      </div>
    </div>

    <div class="cycle-row">
      <div class="cycle-card">
        <div class="cycle-card-title">200 å‘¨å‡çº¿ (200 WMA)</div>
        <div class="cycle-main" id="wma200-price" style="color:var(--blue)">$--,---</div>
        <div class="cycle-sub">
          å½“å‰ä»·æ ¼ / 200WMA = <span id="wma200-ratio">--</span>x<br>
          <span id="wma200-note" style="color:var(--dim)">BTC å†å²ä¸Šä»æœªé•¿æœŸè·Œç ´ 200WMA</span>
        </div>
      </div>
      <div class="cycle-card">
        <div class="cycle-card-title">Balanced Price (å‡è¡¡ä»·æ ¼)</div>
        <div class="cycle-main" id="bp-price" style="color:var(--green)">$--,---</div>
        <div class="cycle-sub">
          å½“å‰ä»·æ ¼ / BP = <span id="bp-ratio">--</span>x<br>
          <span id="bp-note" style="color:var(--dim)">å·²å®ç°ä»·æ ¼ âˆ’ è½¬ç§»ä»·æ ¼ï¼Œå†å²å‘¨æœŸåº•éƒ¨å‚è€ƒ</span>
        </div>
      </div>
      <div class="cycle-card">
        <div class="cycle-card-title">MVRV Ratio (å¸‚å€¼/å·²å®ç°å¸‚å€¼)</div>
        <div class="cycle-main" id="mvrv-value" style="color:var(--green)">--</div>
        <div class="cycle-sub">
          <span id="mvrv-note" style="color:var(--dim)">&lt;1 ä½ä¼° Â· 1~3.5 æ­£å¸¸ Â· &gt;3.5 è¿‡çƒ­</span>
        </div>
      </div>
      <div class="cycle-card">
        <div class="cycle-card-title">â³ å‡åŠå€’è®¡æ—¶</div>
        <div class="cycle-main" id="halving-days" style="color:var(--gold)">--- å¤©</div>
        <div class="cycle-sub">
          å½“å‰åŒºå— <span id="halving-block">---</span> / ç›®æ ‡ <span>1,050,000</span><br>
          å¥–åŠ± 3.125 â†’ <span>1.5625 BTC</span> Â· é¢„è®¡ <span id="halving-date">---</span>
        </div>
        <div class="halving-bar"><div class="halving-fill" id="halving-fill" style="width:0%"></div></div>
      </div>
    </div>

    <!-- mNAV ä¸“åŒº -->
    <div class="cycle-row" style="margin-top:12px">
      <div class="cycle-card">
        <div class="cycle-card-title">MSTR mNAV (Strategy)</div>
        <div class="cycle-main" id="mstr-mnav">--</div>
        <div class="cycle-sub">
          Basic: <span id="mstr-basic">--</span> Â· EV: <span id="mstr-ev">--</span><br>
          <span id="mstr-detail" style="color:var(--dim)">BTC: -- | $--</span>
        </div>
      </div>
      <div class="cycle-card">
        <div class="cycle-card-title">SBET mNAV (SharpLink)</div>
        <div class="cycle-main" id="sbet-mnav">--</div>
        <div class="cycle-sub">
          <span id="sbet-detail" style="color:var(--dim)">ETH: -- | $--</span>
        </div>
      </div>
      <div class="cycle-card">
        <div class="cycle-card-title">BMNR mNAV (BitMine)</div>
        <div class="cycle-main" id="bmnr-mnav">--</div>
        <div class="cycle-sub">
          <span id="bmnr-detail" style="color:var(--dim)">ETH: -- | $--</span>
        </div>
      </div>
    </div>

    <div class="elec-control">
      <span class="elec-label">ç”µè´¹:</span>
      <input type="range" class="elec-slider" id="electricity" min="0.02" max="0.15" step="0.005" value="0.06">
      <span class="elec-value" id="elec-value">$0.060/kWh</span>
    </div>

    <div class="percentiles">
      <div class="pct-item" id="pct-25"><div class="pct-label">P25</div><div class="pct-value" id="p25-val">--</div></div>
      <div class="pct-item active" id="pct-50"><div class="pct-label">P50</div><div class="pct-value" id="p50-val">--</div></div>
      <div class="pct-item" id="pct-75"><div class="pct-label">P75</div><div class="pct-value" id="p75-val">--</div></div>
      <div class="pct-item" id="pct-90"><div class="pct-label">P90</div><div class="pct-value" id="p90-val">--</div></div>
    </div>

    <div class="chart-section">
      <div class="chart-title">çŸ¿æœºå¯¹æ¯”</div>
      <div id="chart-container"></div>
    </div>

    <div class="table-section">
      <div class="table-title">çŸ¿æœºè¯¦æƒ…</div>
      <table class="miner-table">
        <thead>
          <tr><th>çŸ¿æœºå‹å·</th><th>ç®—åŠ›</th><th>åŠŸè€—</th><th>åŠŸè€—æ¯”</th><th>å…³æœºä»·</th><th>çŠ¶æ€</th></tr>
        </thead>
        <tbody id="miner-tbody"></tbody>
      </table>
    </div>

    <div class="footer">
      <p>æ•°æ®: Binance Â· mempool.space | <a href="/">Bo's Lab</a> Â· çµæ„Ÿæ¥è‡ª <a href="https://fuckbtc.com" target="_blank">fuckbtc.com</a></p>
    </div>
  </div>

  <script>
    const BLOCK_REWARD = 3.125;

    const MINERS = [
      { model: 'Antminer U3S23 Hyd.', hashrate: 1160, power: 11020 },
      { model: 'Antminer S23 Hyd.', hashrate: 380, power: 5428 },
      { model: 'Whatsminer M73', hashrate: 512, power: 7424 },
      { model: 'SEALMINER A2 Pro Hyd', hashrate: 500, power: 7450 },
      { model: 'Whatsminer M70', hashrate: 310, power: 5270 },
      { model: 'Antminer S21+ Hyd.', hashrate: 319, power: 4785 },
      { model: 'Whatsminer M66S', hashrate: 298, power: 5067 },
      { model: 'Antminer S21 Hyd.', hashrate: 335, power: 5360 },
      { model: 'Antminer S21 Pro', hashrate: 234, power: 3510 },
      { model: 'Antminer S21', hashrate: 200, power: 3500 },
      { model: 'Whatsminer M63S', hashrate: 390, power: 7215 },
      { model: 'Whatsminer M60S', hashrate: 186, power: 3422 },
      { model: 'Antminer T21', hashrate: 190, power: 3610 },
      { model: 'Whatsminer M56S++', hashrate: 230, power: 5290 },
      { model: 'Antminer S19 XP Hyd.', hashrate: 255, power: 5304 },
      { model: 'Antminer S19 XP', hashrate: 140, power: 3010 },
      { model: 'Whatsminer M50S++', hashrate: 150, power: 3276 },
      { model: 'Whatsminer M50S+', hashrate: 140, power: 3080 },
      { model: 'Avalon A1466', hashrate: 150, power: 3350 },
      { model: 'Whatsminer M50', hashrate: 118, power: 3276 },
      { model: 'Antminer S19j Pro+', hashrate: 122, power: 3355 },
      { model: 'Antminer S19 Pro', hashrate: 110, power: 3250 },
      { model: 'Antminer S19j Pro', hashrate: 104, power: 3068 },
    ].filter(m => (m.power / m.hashrate) <= 29.5);

    let currentPrice = 0, currentDifficulty = 0;

    // === ç¼“å­˜å±‚ ===
    function cacheSet(k, v) {
      try { localStorage.setItem('btc_' + k, JSON.stringify({ t: Date.now(), v })); } catch(_) {}
    }
    function cacheGet(k, maxAge = 3600000) { // é»˜è®¤1å°æ—¶æœ‰æ•ˆ
      try {
        const d = JSON.parse(localStorage.getItem('btc_' + k));
        if (d && (Date.now() - d.t) < maxAge) return d.v;
      } catch(_) {}
      return null;
    }

    // å¯åŠ¨æ—¶ç«‹å³æ˜¾ç¤ºç¼“å­˜æ•°æ®
    function loadCache() {
      const p = cacheGet('price', 86400000); // ä»·æ ¼ç¼“å­˜24h
      if (p) {
        currentPrice = p.price;
        document.getElementById('btc-price').innerHTML =
          '$' + p.price.toLocaleString('en-US', {maximumFractionDigits:0}) +
          ' <span style="font-size:12px;color:var(--dim)">ç¼“å­˜</span>';
      }
      const h = cacheGet('hashrate', 86400000);
      if (h) {
        currentDifficulty = h.diff;
        document.getElementById('hashrate').textContent = h.hr + ' EH/s';
      }
      if (currentPrice > 0 && currentDifficulty > 0) updateAll();

      const fng = cacheGet('fng', 7200000);
      if (fng) applyFng(fng);
      const wma = cacheGet('wma200', 86400000);
      if (wma) applyWma200(wma);
      const bp = cacheGet('bp', 86400000);
      if (bp) applyBp(bp);
      const halv = cacheGet('halving', 86400000);
      if (halv) applyHalving(halv);
      const ahr = cacheGet('ahr999', 86400000);
      if (ahr) applyAhr999(ahr);
      const mvrv = cacheGet('mvrv', 86400000);
      if (mvrv) applyMvrv(mvrv);
      try {
        const mstrC = cacheGet('mstr-mnav', 86400000);
        if (mstrC && mstrC.ev) {
          applyMnav('mstr-mnav', mstrC.ev);
          document.getElementById('mstr-basic').textContent = mstrC.basic.toFixed(2) + 'x';
          document.getElementById('mstr-ev').textContent = mstrC.ev.toFixed(2) + 'x';
          document.getElementById('mstr-detail').textContent = 'BTC ' + mstrC.holdings.toLocaleString() + ' | $' + mstrC.price;
        }
        const sbetC = cacheGet('sbet-mnav', 86400000);
        if (sbetC && sbetC.mnav) { applyMnav('sbet-mnav', sbetC.mnav); document.getElementById('sbet-detail').textContent = 'ETH ' + sbetC.eth.toLocaleString() + ' | $' + (sbetC.stockPrice || sbetC.ethPrice || ''); }
        const bmnrC = cacheGet('bmnr-mnav', 86400000);
        if (bmnrC && bmnrC.mnav) { applyMnav('bmnr-mnav', bmnrC.mnav); document.getElementById('bmnr-detail').textContent = 'ETH ' + bmnrC.eth.toLocaleString() + ' | $' + bmnrC.price; }
      } catch(e) { console.error('mNAV cache load error:', e); }
    }

    // å¸¦è¶…æ—¶çš„ fetch
    function fetchTimeout(url, ms = 8000) {
      const ctrl = new AbortController();
      const timer = setTimeout(() => ctrl.abort(), ms);
      return fetch(url, { signal: ctrl.signal }).finally(() => clearTimeout(timer));
    }

    // BTC ä»·æ ¼ï¼šBinance â†’ OKX â†’ CoinGecko â†’ Blockchain.info
    async function fetchPrice() {
      // Binance
      try {
        const r = await fetchTimeout('https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT', 5000);
        const d = await r.json();
        return { price: parseFloat(d.lastPrice), chg: parseFloat(d.priceChangePercent) };
      } catch (_) {}
      // OKX
      try {
        const r = await fetchTimeout('https://www.okx.com/api/v5/market/ticker?instId=BTC-USDT', 5000);
        const d = await r.json();
        const t = d.data[0];
        const chg = ((parseFloat(t.last) - parseFloat(t.open24h)) / parseFloat(t.open24h) * 100);
        return { price: parseFloat(t.last), chg };
      } catch (_) {}
      // CoinGecko
      try {
        const r = await fetchTimeout('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true', 5000);
        const d = await r.json();
        return { price: d.bitcoin.usd, chg: d.bitcoin.usd_24h_change };
      } catch (_) {}
      // Blockchain.info
      try {
        const r = await fetchTimeout('https://blockchain.info/ticker', 5000);
        const d = await r.json();
        return { price: d.USD.last, chg: 0 };
      } catch (_) {}
      return null;
    }

    async function fetchData() {
      try {
        // å¹¶è¡Œæ‹‰ä»·æ ¼å’Œç®—åŠ›
        const [priceData, mRes] = await Promise.all([
          fetchPrice(),
          fetchTimeout('https://mempool.space/api/v1/mining/hashrate/3d', 8000)
            .then(r => r.json()).catch(() => null)
        ]);

        if (priceData) {
          currentPrice = priceData.price;
          const chg = priceData.chg;
          document.getElementById('btc-price').innerHTML =
            '$' + currentPrice.toLocaleString('en-US', {maximumFractionDigits:0}) +
            ' <span style="font-size:12px;color:' + (chg >= 0 ? 'var(--green)' : 'var(--red)') + '">' +
            (chg >= 0 ? 'â†‘' : 'â†“') + Math.abs(chg).toFixed(2) + '%</span>';
          cacheSet('price', priceData);
        }

        if (mRes) {
          currentDifficulty = mRes.currentDifficulty;
          const hrVal = (mRes.currentHashrate / 1e18).toFixed(1);
          document.getElementById('hashrate').textContent = hrVal + ' EH/s';
          cacheSet('hashrate', { diff: mRes.currentDifficulty, hr: hrVal });
        }

        if (currentPrice > 0 && currentDifficulty > 0) updateAll();
      } catch (e) { console.error('fetchData:', e); }
    }

    function calcShutdown(hr, pw, diff, elec) {
      const btcPerDay = (86400 * hr * 1e12 * BLOCK_REWARD) / (diff * Math.pow(2, 32));
      return (pw * 24 / 1000 * elec) / btcPerDay;
    }

    function pct(arr, p) {
      const s = [...arr].sort((a, b) => a - b);
      const i = (p / 100) * (s.length - 1);
      const lo = Math.floor(i), hi = Math.ceil(i);
      return lo === hi ? s[lo] : s[lo] + (s[hi] - s[lo]) * (i - lo);
    }

    function fmt(v) { return '$' + Math.round(v).toLocaleString(); }

    function updateAll() {
      const elec = parseFloat(document.getElementById('electricity').value);
      const data = MINERS.map(m => ({
        ...m,
        eff: (m.power / m.hashrate).toFixed(1),
        sp: calcShutdown(m.hashrate, m.power, currentDifficulty, elec)
      })).sort((a, b) => a.sp - b.sp);

      const sps = data.map(d => d.sp);
      const profitN = sps.filter(p => currentPrice > p).length;
      const p25 = pct(sps, 25), p50 = pct(sps, 50), p75 = pct(sps, 75), p90 = pct(sps, 90);

      document.getElementById('p25-val').textContent = fmt(p25);
      document.getElementById('p50-val').textContent = fmt(p50);
      document.getElementById('p75-val').textContent = fmt(p75);
      document.getElementById('p90-val').textContent = fmt(p90);
      document.getElementById('range').textContent = fmt(Math.min(...sps)) + ' ~ ' + fmt(Math.max(...sps));
      document.getElementById('profit-count').innerHTML = '<span class="profit">' + profitN + '</span>/' + data.length;

      // ahr999 ç”± fetchAhr999() ç‹¬ç«‹æ›´æ–°

      // ç™¾åˆ†ä½é«˜äº®
      ['pct-25','pct-50','pct-75','pct-90'].forEach(id => document.getElementById(id).classList.remove('active'));
      if (currentPrice <= p25) document.getElementById('pct-25').classList.add('active');
      else if (currentPrice <= p50) document.getElementById('pct-50').classList.add('active');
      else if (currentPrice <= p75) document.getElementById('pct-75').classList.add('active');
      else document.getElementById('pct-90').classList.add('active');

      // === å›¾è¡¨ï¼šCSS Gridï¼Œæ¡å½¢å’Œä»·æ ¼çº¿åœ¨åŒä¸€ä¸ªå®¹å™¨ ===
      const xCeil = Math.ceil(Math.max(currentPrice * 1.15, Math.max(...sps) * 1.1) / 30000) * 30000;
      const nSteps = xCeil / 30000;
      const cc = document.getElementById('chart-container');

      let labelsHtml = '';
      let barsHtml = '';

      data.forEach(d => {
        const wPct = (d.sp / xCeil * 100).toFixed(4);
        const ok = currentPrice > d.sp;
        labelsHtml += '<div class="chart-lbl">' + d.model + '</div>';
        // æ¡å½¢ = ä»0åˆ°å…³æœºä»·çš„ç»å¯¹ä½ç½®
        barsHtml += '<div class="cbar ' + (ok ? 'profit' : 'loss') + '" style="width:' + wPct + '%"></div>';
      });

      // ä»·æ ¼ç«–çº¿ â€” åŒå®¹å™¨ï¼ŒåŒç™¾åˆ†æ¯”
      const pricePct = (currentPrice / xCeil * 100).toFixed(4);

      // X è½´åˆ»åº¦ â€” ç»å¯¹å®šä½ï¼Œä¸æ¡å½¢å®Œå…¨å¯¹é½
      let xTicksHtml = '';
      for (let i = 0; i <= nSteps; i++) {
        const tickPct = (i / nSteps * 100).toFixed(4);
        xTicksHtml += '<span class="x-tick" style="left:' + tickPct + '%">$' + (30000 * i / 1000) + 'k</span>';
      }

      cc.innerHTML =
        '<div class="chart-grid">' +
          '<div class="chart-labels">' + labelsHtml + '</div>' +
          '<div class="chart-bars">' +
            barsHtml +
            '<div class="vprice" style="left:' + pricePct + '%">' +
              '<div class="vprice-tag">BTC ' + fmt(currentPrice) + '</div>' +
            '</div>' +
          '</div>' +
        '</div>' +
        '<div class="x-axis-row">' +
          '<div></div>' +
          '<div class="x-axis-track">' + xTicksHtml + '</div>' +
        '</div>';

      // è¡¨æ ¼
      document.getElementById('miner-tbody').innerHTML = data.map(d => {
        const ok = currentPrice > d.sp;
        return '<tr><td class="model">' + d.model + '</td><td>' + d.hashrate + ' TH/s</td><td>' +
          d.power + ' W</td><td>' + d.eff + ' W/TH</td><td class="shutdown ' + (ok?'profit':'loss') + '">' +
          fmt(d.sp) + '</td><td><span class="status-badge ' + (ok?'status-profit':'status-loss') + '">' +
          (ok?'ç›ˆåˆ©':'äºæŸ') + '</span></td></tr>';
      }).join('');
    }

    function applyMvrv(mvrv) {
      const el = document.getElementById('mvrv-value');
      el.textContent = mvrv.toFixed(2);
      const noteEl = document.getElementById('mvrv-note');
      if (mvrv < 1) { el.style.color = 'var(--green)'; noteEl.textContent = 'ğŸŸ¢ MVRV < 1 â€” ä½ä¼°åŒºé—´ï¼Œå†å²å¤§åº•'; noteEl.style.color = 'var(--green)'; }
      else if (mvrv < 2) { el.style.color = 'var(--green)'; noteEl.textContent = 'âœ… æ­£å¸¸åä½ â€” æŒå¸/å®šæŠ•åŒºé—´'; noteEl.style.color = 'var(--green)'; }
      else if (mvrv < 3.5) { el.style.color = 'var(--gold)'; noteEl.textContent = 'ğŸ“ˆ æ­£å¸¸åé«˜ â€” æ³¨æ„é£é™©'; noteEl.style.color = 'var(--dim)'; }
      else { el.style.color = 'var(--red)'; noteEl.textContent = 'ğŸ”´ MVRV > 3.5 â€” è¿‡çƒ­ï¼Œå†å²é¡¶éƒ¨åŒºé—´'; noteEl.style.color = 'var(--red)'; }
    }

    async function fetchMvrv() {
      try {
        const res = await fetchTimeout('https://looknode-proxy.corms-cushier-0l.workers.dev/mCapRealizedRatio', 10000);
        const json = await res.json();
        if (json.code !== 100 || !json.data || json.data.length === 0) return;
        const mvrv = json.data[json.data.length - 1].v;
        applyMvrv(mvrv);
        cacheSet('mvrv', mvrv);
      } catch (e) { console.error('MVRV error:', e); }
    }

    function applyMnav(id, val) {
      const el = document.getElementById(id);
      el.textContent = val.toFixed(2) + 'x';
      el.style.color = val < 1 ? 'var(--green)' : val < 2 ? 'var(--gold)' : 'var(--red)';
    }

    async function fetchMnavAll() {
      // ç­‰ BTC ä»·æ ¼åŠ è½½ï¼ˆæœ€å¤šç­‰ 10sï¼‰
      for (var i = 0; i < 20 && currentPrice <= 0; i++) await new Promise(r => setTimeout(r, 500));
      console.log('[mNAV] start, btcPrice=' + currentPrice);

      try {
        var res = await fetchTimeout('https://looknode-proxy.corms-cushier-0l.workers.dev/mnav', 15000);
        var d = await res.json();
        console.log('[mNAV] API response:', JSON.stringify(d).substring(0, 200));
        if (d.error) { console.error('mNAV API error:', d.error); return; }

        var btcPrice = currentPrice || 65000; // fallback
        var ethPrice = d.eth_price || 0;

        // === MSTR ===
        var m = d.mstr;
        if (m && m.btc_holdings && m.stock_price) {
          var btcValue = m.btc_holdings * btcPrice;
          var mcap = m.stock_price * m.shares;
          var basicMnav = mcap / btcValue;
          var evMnav = (mcap + m.debt + m.pref) / (btcValue + m.cash);
          applyMnav('mstr-mnav', evMnav);
          document.getElementById('mstr-basic').textContent = basicMnav.toFixed(2) + 'x';
          document.getElementById('mstr-basic').style.color = basicMnav < 1 ? 'var(--green)' : 'var(--gold)';
          document.getElementById('mstr-ev').textContent = evMnav.toFixed(2) + 'x';
          document.getElementById('mstr-detail').textContent = 'BTC ' + m.btc_holdings.toLocaleString() + ' | $' + m.stock_price;
          cacheSet('mstr-mnav', { basic: basicMnav, ev: evMnav, holdings: m.btc_holdings, price: m.stock_price });
        }

        // === SBET ===
        var s = d.sbet;
        if (s && s.eth_holdings && s.market_cap) {
          // ä¼˜å…ˆç”¨ market_cap / eth_nav è®¡ç®—
          if (ethPrice > 0) {
            var sbetNav = s.eth_holdings * ethPrice;
            var sbetMnav = s.market_cap / sbetNav;
            applyMnav('sbet-mnav', sbetMnav);
            document.getElementById('sbet-detail').textContent = 'ETH ' + s.eth_holdings.toLocaleString() + ' | $' + (s.stock_price || '');
            cacheSet('sbet-mnav', { mnav: sbetMnav, eth: s.eth_holdings, stockPrice: s.stock_price || '', ethPrice: ethPrice });
          } else if (s.fd_mnav) {
            applyMnav('sbet-mnav', s.fd_mnav);
            document.getElementById('sbet-detail').textContent = 'ETH ' + s.eth_holdings.toLocaleString() + ' | FD mNAV';
            cacheSet('sbet-mnav', { mnav: s.fd_mnav, eth: s.eth_holdings, ethPrice: 0 });
          }
        } else if (s && s.fd_mnav) {
          applyMnav('sbet-mnav', s.fd_mnav);
          document.getElementById('sbet-detail').textContent = 'ETH ' + (s.eth_holdings || 0).toLocaleString() + ' | FD mNAV';
          cacheSet('sbet-mnav', { mnav: s.fd_mnav, eth: s.eth_holdings || 0, ethPrice: 0 });
        }

        // === BMNR ===
        var b = d.bmnr;
        if (b && b.eth_holdings && b.stock_price && ethPrice > 0) {
          var bmnrNav = b.eth_holdings * ethPrice;
          var bmnrMcap = b.stock_price * b.shares;
          var bmnrMnav = bmnrMcap / bmnrNav;
          applyMnav('bmnr-mnav', bmnrMnav);
          document.getElementById('bmnr-detail').textContent = 'ETH ' + b.eth_holdings.toLocaleString() + ' | $' + b.stock_price;
          cacheSet('bmnr-mnav', { mnav: bmnrMnav, eth: b.eth_holdings, price: b.stock_price });
        }
      } catch (e) { console.error('mNAV error:', e); }
    }

    function applyBp(bp) {
      document.getElementById('bp-price').textContent = '$' + Math.round(bp).toLocaleString();
      if (currentPrice <= 0) return;
      const ratio = currentPrice / bp;
      const ratioEl = document.getElementById('bp-ratio');
      ratioEl.textContent = ratio.toFixed(2);
      const noteEl = document.getElementById('bp-note');
      if (ratio < 1) { ratioEl.style.color = 'var(--red)'; noteEl.textContent = 'âš ï¸ ä½äº BP â€” æåº¦ä½ä¼°ï¼Œå†å²å‘¨æœŸå¤§åº•'; noteEl.style.color = 'var(--red)'; }
      else if (ratio < 1.5) { ratioEl.style.color = 'var(--green)'; noteEl.textContent = 'âœ… æ¥è¿‘ BP â€” åº•éƒ¨åŒºé—´'; noteEl.style.color = 'var(--green)'; }
      else if (ratio < 3) { ratioEl.style.color = 'var(--text)'; noteEl.textContent = 'ğŸ“ˆ é«˜äº BP â€” æ­£å¸¸ä¼°å€¼åŒºé—´'; noteEl.style.color = 'var(--dim)'; }
      else { ratioEl.style.color = 'var(--gold)'; noteEl.textContent = 'ğŸ”¥ è¿œè¶… BP â€” ä¼°å€¼åé«˜'; noteEl.style.color = 'var(--gold)'; }
    }

    async function fetchBalancedPrice() {
      try {
        const res = await fetchTimeout('https://looknode-proxy.corms-cushier-0l.workers.dev/balancedPrice', 10000);
        const json = await res.json();
        if (json.code !== 100 || !json.data || json.data.length === 0) return;
        const bp = json.data[json.data.length - 1].v;
        applyBp(bp);
        cacheSet('bp', bp);
      } catch (e) { console.error('BalancedPrice error:', e); }
    }

    function applyWma200(wma200) {
      document.getElementById('wma200-price').textContent = '$' + Math.round(wma200).toLocaleString();
      if (currentPrice <= 0) return;
      const ratio = currentPrice / wma200;
      const ratioEl = document.getElementById('wma200-ratio');
      ratioEl.textContent = ratio.toFixed(2);
      const noteEl = document.getElementById('wma200-note');
      if (ratio < 1) { ratioEl.style.color = 'var(--red)'; noteEl.textContent = 'âš ï¸ ä½äº 200WMA â€” æç«¯ç†Šå¸‚ä¿¡å·'; noteEl.style.color = 'var(--red)'; }
      else if (ratio < 1.5) { ratioEl.style.color = 'var(--green)'; noteEl.textContent = 'âœ… æ¥è¿‘ 200WMA â€” å†å²åº•éƒ¨åŒºé—´'; noteEl.style.color = 'var(--green)'; }
      else if (ratio < 3) { ratioEl.style.color = 'var(--gold)'; noteEl.textContent = 'ğŸ“ˆ é«˜äº 200WMA â€” æ­£å¸¸ç‰›å¸‚åŒºé—´'; noteEl.style.color = 'var(--dim)'; }
      else { ratioEl.style.color = 'var(--red)'; noteEl.textContent = 'ğŸ”¥ è¿œè¶… 200WMA â€” è¿‡çƒ­ä¿¡å·'; noteEl.style.color = 'var(--red)'; }
    }

    async function fetchWma200() {
      try {
        let closes;
        try {
          const res = await fetchTimeout('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1w&limit=200', 8000);
          const klines = await res.json();
          closes = klines.map(k => parseFloat(k[4]));
        } catch (_) {
          try {
            const res = await fetchTimeout('https://www.okx.com/api/v5/market/candles?instId=BTC-USDT&bar=1W&limit=200', 8000);
            const d = await res.json();
            closes = d.data.map(k => parseFloat(k[4])).reverse();
          } catch (_) { return; }
        }
        const wma200 = closes.reduce((a, b) => a + b, 0) / closes.length;

        applyWma200(wma200);
        cacheSet('wma200', wma200);
      } catch (e) { console.error('200WMA error:', e); }
    }

    function applyHalving(d) {
      document.getElementById('halving-days').textContent = d.days + ' å¤©';
      document.getElementById('halving-block').textContent = d.height.toLocaleString();
      document.getElementById('halving-date').textContent = d.date;
      document.getElementById('halving-fill').style.width = d.progress + '%';
    }

    async function fetchHalving() {
      try {
        const res = await fetchTimeout('https://mempool.space/api/blocks/tip/height', 8000);
        const height = await res.json();
        const halvingInterval = 210000;
        const nextHalving = Math.ceil(height / halvingInterval) * halvingInterval;
        const remaining = nextHalving - height;
        const daysLeft = Math.round(remaining * 10 / (60 * 24));
        const estDate = new Date(Date.now() + daysLeft * 86400000);
        const dateStr = estDate.getFullYear() + '-' + String(estDate.getMonth()+1).padStart(2,'0') + '-' + String(estDate.getDate()).padStart(2,'0');
        const prevHalving = nextHalving - halvingInterval;
        const progress = ((height - prevHalving) / halvingInterval * 100).toFixed(1);
        const d = { days: daysLeft, height, date: dateStr, progress };
        applyHalving(d);
        cacheSet('halving', d);
      } catch (e) { console.error('Halving error:', e); }
    }

    function applyFng(val) {
      const angle = (val / 100) * 180 - 90;
      document.getElementById('fng-needle').style.transform = 'rotate(' + angle + 'deg)';
      const valEl = document.getElementById('fng-value');
      valEl.textContent = val;
      let label, color, desc;
      if (val <= 20) { label = 'æåº¦ææƒ§'; color = 'var(--red)'; desc = 'å¸‚åœºæåº¦ææ…Œï¼Œå¯èƒ½æ˜¯ä¹°å…¥æœºä¼š'; }
      else if (val <= 40) { label = 'ææƒ§'; color = '#f7931a'; desc = 'å¸‚åœºæƒ…ç»ªåç©ºï¼ŒæŠ•èµ„è€…è°¨æ…'; }
      else if (val <= 60) { label = 'ä¸­æ€§'; color = '#f0d000'; desc = 'å¸‚åœºæƒ…ç»ªä¸­æ€§ï¼Œè§‚æœ›ä¸ºä¸»'; }
      else if (val <= 80) { label = 'è´ªå©ª'; color = 'var(--green)'; desc = 'å¸‚åœºæƒ…ç»ªåå¤šï¼Œæ³¨æ„é£é™©'; }
      else { label = 'æåº¦è´ªå©ª'; color = 'var(--green)'; desc = 'å¸‚åœºè¿‡åº¦ä¹è§‚ï¼Œè€ƒè™‘æ­¢ç›ˆ'; }
      valEl.style.color = color;
      document.getElementById('fng-status').textContent = label;
      document.getElementById('fng-status').style.color = color;
      document.getElementById('fng-desc').textContent = desc;
    }

    async function fetchFng() {
      try {
        const res = await fetchTimeout('https://api.alternative.me/fng/?limit=1', 8000);
        const json = await res.json();
        const val = parseInt(json.data[0].value);
        applyFng(val);
        cacheSet('fng', val);
      } catch (e) { console.error('FnG error:', e); }
    }

    function applyAhr999(ahr) {
      const aEl = document.getElementById('ahr999');
      aEl.textContent = ahr.toFixed(2);
      if (ahr < 0.45) { aEl.style.color = 'var(--green)'; aEl.title = 'æŠ„åº•åŒºé—´'; }
      else if (ahr < 1.2) { aEl.style.color = 'var(--green)'; aEl.title = 'å®šæŠ•åŒºé—´'; }
      else if (ahr < 5) { aEl.style.color = 'var(--gold)'; aEl.title = 'è§‚æœ›åŒºé—´'; }
      else { aEl.style.color = 'var(--red)'; aEl.title = 'æ³¡æ²«åŒºé—´'; }
    }

    async function fetchAhr999() {
      try {
        // Binance æ—¥çº¿ â†’ OKX æ—¥çº¿ fallback
        let closes, lastTs;
        try {
          const res = await fetchTimeout('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1d&limit=200', 8000);
          const klines = await res.json();
          closes = klines.map(k => parseFloat(k[4]));
          lastTs = klines[klines.length - 1][0];
        } catch (_) {
          try {
            const res = await fetchTimeout('https://www.okx.com/api/v5/market/candles?instId=BTC-USDT&bar=1D&limit=200', 8000);
            const d = await res.json();
            closes = d.data.map(k => parseFloat(k[4])).reverse();
            lastTs = parseInt(d.data[0][0]);
          } catch (_) { return; }
        }
        const dma200 = closes.reduce((a, b) => a + b, 0) / closes.length;

        if (!lastTs) lastTs = Date.now();
        const genesisTs = new Date('2009-01-03').getTime();
        const coinDays = Math.floor((lastTs - genesisTs) / 86400000);
        const expPrice = Math.pow(10, 5.84 * Math.log10(coinDays) - 17.01);

        const ahr = (currentPrice / dma200) * (currentPrice / expPrice);

        applyAhr999(ahr);
        cacheSet('ahr999', ahr);
      } catch (e) { console.error('ahr999 error:', e); }
    }

    document.getElementById('electricity').addEventListener('input', function() {
      const v = parseFloat(this.value).toFixed(3);
      document.getElementById('elec-value').textContent = '$' + v + '/kWh';
      document.getElementById('elec-display').textContent = '$' + v;
      if (currentPrice > 0 && currentDifficulty > 0) updateAll();
    });

    loadCache(); // ç«‹å³æ˜¾ç¤ºç¼“å­˜æ•°æ®
    fetchData();
    fetchFng();
    setTimeout(() => { fetchAhr999(); fetchWma200(); fetchHalving(); fetchBalancedPrice(); fetchMvrv(); }, 2000);
    setTimeout(fetchMnavAll, 4000); // mNAV å»¶åç¡®ä¿ BTC ä»·æ ¼å·²åŠ è½½
    setInterval(fetchData, 15000);
    setInterval(fetchFng, 600000);
    setInterval(fetchAhr999, 300000);
    setInterval(fetchWma200, 300000);
    setInterval(fetchHalving, 600000);
    setInterval(fetchBalancedPrice, 3600000);
    setInterval(fetchMvrv, 3600000);
    setInterval(fetchMnavAll, 3600000);
  </script>
</body>
</html>
